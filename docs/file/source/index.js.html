<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">source/index.js | amd-bundle</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A dual-use tool for bundling up AMD modules, which is much easier to use than r.js with Almond or AMDclean"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="amd-bundle"><meta property="twitter:description" content="A dual-use tool for bundling up AMD modules, which is much easier to use than r.js with Almond or AMDclean"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/TechQuery/AMD_bundle.js"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/Module.js~Module.html">Module</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/source/Package.js~Package.html">Package</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generate">generate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNPMFile">getNPMFile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNPMIndex">getNPMIndex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNPMPackage">getNPMPackage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-merge">merge</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-outPackage">outPackage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toES_5">toES_5</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-toRegExp">toRegExp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-DependencyMap">DependencyMap</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">source/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">#! /usr/bin/env node

const  Path = require(&apos;path&apos;),  FS = require(&apos;fs-extra&apos;);

const  Command = require(&apos;commander&apos;),  Config = require(&apos;../package.json&apos;);

require(&apos;babel-register&apos;);  require(&apos;babel-polyfill&apos;);

const  Package = require(&apos;./Package&apos;).default,  utility = require(&apos;./utility&apos;);


Command.version( Config.version ).usage(&apos;[options] &lt;entry file&gt; [bundle file]&apos;)
    .arguments(&apos;&lt;entry file&gt; [bundle file]&apos;)
    .option(
        &apos;-a, --include-all&apos;,
        &apos;Bundle all dependencies (include those in &quot;./node_modules/&quot;)&apos;
    )
    .option(
        &apos;-m, --module-map &lt;name pairs&gt;&apos;,  [
            &apos;Map to replace some dependencies to others&apos;,
            &apos;(For example:  old_1:new_1,/some_/i:new_2)&apos;
        ].join(&apos; &apos;)
    )
    .option(&apos;-c, --command-line&apos;,  &apos;Bundle as a command script&apos;)
    .option(&apos;-s, --std-out&apos;,  &apos;Write into &quot;stdout&quot; without logs&apos;)
    .parse( process.argv );


const entry_file = Command.args[0], module_map = new Map();

(Command.moduleMap || &apos;&apos;).replace(
    /(.+?):([^,]+)/g,
    (_, oldName, newName)  =&gt;
        module_map.set(utility.toRegExp( oldName ) || oldName,  newName)
);

const bundle_file = (
        Command.args[1] ||
        Path.join(entry_file,  &apos;../../&apos;,  Path.basename( entry_file ))
    ) + &apos;.js&apos;,
    pack = new Package(
        entry_file,  Command.includeAll,  module_map,  Command.stdOut
    );

if (! Command.stdOut)  console.time(&apos;Package bundle&apos;);

var code = pack.bundle( Path.basename( bundle_file ).split(&apos;.&apos;)[0] );

if ( Command.commandLine )  code = &apos;#! /usr/bin/env node\n\n&apos; + code;

if ( Command.stdOut )
    process.stdout.write( code );
else {
    FS.outputFileSync(bundle_file,  code);

    console.info( &apos;-&apos;.repeat( 30 ) );

    console.timeEnd(&apos;Package bundle&apos;);

    console.info(`Module count: ${pack.length}`);
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
